@model Ground_Handlng.DataObjects.Models.Operational.Forms.PregnancyCertificate.PregnancyCertificate
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{

}
<link rel="stylesheet" href="~/AdminLTE/dist/css/adminlte.min.css" />
<link rel="stylesheet" href="~/AdminLTE/plugins/bootstrap/css/bootstrap.min.css" />
<link rel="stylesheet" href="~/AdminLTE/plugins/datepicker/datepicker3.css" />
<link rel="stylesheet" href="~/AdminLTE/plugins/iCheck/square/blue.css" />
<style type="text/css">

    div#modal {
        width: 100%;
        z-index: 1100;
    }

    #modal .modal-dialog {
        max-width: 80%;
        z-index: 100000;
    }

    input.input-has-value {
        color: red;
    }
    /* For standards browsers */
    /*input[type="text"]:focus {
            border: 1px solid #f00;
        }*/

    /* For Internet Explorer */
    /*input.focus {
            border: 1px solid #f00;
        }*/
    .error {
        border: 2px solid red;
    }
</style>

<section class="container">
    <div class="card">
        <div class="card-body">
            @using (Html.BeginForm(FormMethod.Post, new { @class = "form-horizontal", @id = "validate", @enctype = "multipart/form-data", @role = "form" }))
            {
                @Html.AntiForgeryToken()

                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                <div class="form-group row">
                    <p>
                        i certify that i am physically able travel by air
                        from <input asp-for="From" class="form-control" value="@Model.From" name="from" placeholder="From" />
                        to <input asp-for="To" class="form-control" name="to" value="@Model.To" placeholder="To" /> on <input for="DateOfTravel" class="form-control required date"  value="@Model.DateOfTravel" name="dateoftravel" placeholder="On" />
                    </p>
                </div>
                <div class="form-group row">
                    <p>and that the estimated date of the birth of my baby is  <input for="DateOfBirthEstimated" class="form-control required datebirth"  value="@Model.DateOfBirthEstimated" name="dateofbirthestimated" /> </p>
                </div>
                <div class="form-group row">
                    <p>I/we hereby release Ethiopian Airlines from all liability in connection with My/our traveling under these conditions.</p>
                </div>
                <div class="form-group row">
                    <p>Date <input for="DateCertificateIssued" class="form-control required datecertificateissued" name="datecertificateissued" /> Signed <input asp-for="SignatureOfPassenger" class="form-control"  value="@Model.SignatureOfPassenger" name="signatureofpassenger" /></p>
                </div>
                <div class="form-group row">
                    <p class="col-sm-5 float-right">Closest Relative <input asp-for="SignatureOfRelative" class="form-control"   value="@Model.SignatureOfRelative" name="signatureofrelative" /></p>
                </div>

                <br />




                <div class="form-group col-md-3">
                    <button type="submit" class="btn btn-success btn-block"> Save </button>
                </div>
            }

        </div>
    </div>
</section>


<script src="~/AdminLTE/plugins/datepicker/bootstrap-datepicker.js"></script>
<script src="~/AdminLTE/plugins/jquery-validation/jquery.validate.min.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
<script type="text/javascript">
    $('.date').datepicker({
        format: 'yyyy-mm-dd'
    });
    $('.datebirth').datepicker({
        format: 'yyyy-mm-dd'
    });
    $('.datecertificateissued').datepicker({
        format: 'yyyy-mm-dd'
    });
    $.validator.setDefaults({
        submitHandler: function () {
            $('#general-error').hide();
            $('#errors').empty();
            var formData = new FormData();
            //formData.append('url', $('#url')[0].files[0]);
            var other_data = $('#validate').serializeArray();
            $.each(other_data, function (key, input) {
                formData.append(input.name, input.value);
            });
            $.ajax({
                url: '/Operational/PregnancyCertificate/Edit',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                cache: false,
                success: function (data) {
                    debugger;
                    if (data.status == "3" || data.status == "4" || data.status == "5") {
                        if (data.status == "3") {
                            swal({
                                type: 'success',
                                title: data.message,
                                showConfirmButton: false,
                                timer: 3000
                            }).then(() => { window.location = "/Operational/PregnancyCertificate/Index"; });;
                            $('#modal').modal('hide');
                        }
                        else {
                            swal({
                                type: 'error',
                                title: data.message,
                                showConfirmButton: false,
                                timer: 3000
                            });
                        }
                    }
                },
                error: function (datd) {
                    window.location = "/Operational/PregnancyCertificate/Index";
                    swal({
                        type: 'error',
                        title: data.message,
                        showConfirmButton: false,
                        timer: 3000
                    });

                }

            });
        }
    });
    $('#validate').validate({
        ignore: [],
        errorPlacement: function () { },
        invalidHandler: function () {
            setTimeout(function () {
                $('.nav-tabs a small.required').remove();
                var validatePane = $('.tab-content.tab-validate .tab-pane:has(input.error)').each(function () {
                    debugger;
                    var id = $(this).attr('id');
                    $('.nav-tabs').find('a[href^="#' + id + '"]').append('<small class="required">***</small>');
                });
            });
        },
        rules: {
            dateofbirthestimated: {
                required: true
            },
            from: {
                required: true
            },
            to: {
                required: true
            },
            dateoftravel: {
                required: true
            },
            datecertificateissued: {
                required: true
            },
            signatureofpassenger: {
                required: true
            },
            signatureofrelative: {
                required: true
            },
            identitycard: {
                required: true
            },
            url: {
                required: true,
                //fileMaxSize : true,
                //extension: "docx|rtf|doc|pdf",
            },
        },
        messages: {
            dateofbirthestimated: {
                required: "Please enter a date of birth estimated"
            },
            from: {
                required: "Please provide a Depature From",
            },
            to: {
                required: "Please enter a Destination To"
            },
            dateoftravel: {
                required: "Please provide a date of travel",
            },
            datecertificateissued: {
                required: "Please enter a date certificate issued"
            },
            signatureofpassenger: {
                required: "Please provide a signature of passenger",
            },
            signatureofrelative: {
                required: "Please enter a signature of relative"
            },
            identitycard: {
                required: "Please provide a identity card",
            },
            url: {
                required: "Please provide a PDF",
                //extension: "Please upload valid file formats"
            },
        },
        errorElement: 'span',
        errorPlacement: function (error, element) {
            error.addClass('invalid-feedback');
            element.closest('.form-group').append(error);
        },
        highlight: function (element, errorClass, validClass) {
            $(element).addClass('is-invalid');
        },
        unhighlight: function (element, errorClass, validClass) {
            $(element).removeClass('is-invalid');
        }

    });
</script>
